#!/bin/bash

#Copyright(c) 2019 Lianjia, Inc. All Rights Reserved
#Permission is hereby granted, free of charge, to any person obtaining a copy of this software and
#associated documentation files (the "Software"), to deal in the Software without restriction,
#including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense,
#and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do
#so, subject to the following conditions:
#
#The above copyright notice and this permission notice shall be included in all copies or substantial
#portions of the Software.
#
#THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
#IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
#FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
#THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR
#OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
#ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
#OTHER DEALINGS IN THE SOFTWARE.

# ç¨‹åºå…¥å£
function main() {
    if [ ! $1 ]
    then
        help $@
    elif [ $1 = "--help" ]
    then
        help $@
    elif [ $1 = "--desc" ]
    then
        description $@
    else
        # è¿™é‡Œæ˜¯ä½ çš„åŠŸèƒ½å¤„ç†é€»è¾‘
        dispose $@
    fi
}

# å¸®åŠ©
function help() {
    echo $outputPrefix"é€šç”¨çš„ä½¿ç”¨æ ¼å¼ä¸ºï¼š\"sh benchmark [operation] [source] [options]\""
    echo $outputPrefix"[operation] åˆ†ä¸º \"connectã€clearã€help\" ... ç­‰æ“ä½œ"
    echo $outputPrefix"å‘½ä»¤è¡Œè¾“å…¥ \"sh benchmark list\" å¯æŸ¥çœ‹æ‰€æœ‰[operation]ç»„ä»¶"
    echo $outputPrefix"[source] ä¸€èˆ¬ä¸ºè¾“å…¥æºï¼Œå¤šä¸º \"æ–‡ä»¶å¤¹ã€æ–‡ä»¶ã€podspecs_name\" ç­‰"
    echo $outputPrefix"[operation]æ›´è¯¦ç»†çš„ä½¿ç”¨ç»†èŠ‚ï¼Œè¯·è¾“å…¥ \"sh benchmark help --[operation]\" æŸ¥çœ‹ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š"
    echo $outputPrefix"\t\"sh benchmark help --connect\""
    echo $outputPrefix"\t\"sh benchmark help --clear\""
    echo $outputPrefix"\t\..."
    echo $outputPrefix"å¦‚æœæ‚¨æœ‰æ›´å¤šçš„å»ºè®®ï¼Œè¯·è”ç³»é“¾å®¶ï¼Œæˆ‘ä»¬æ¬¢è¿æ‚¨çš„å®è´µå»ºè®®ï¼ŒğŸ˜†"
}

# æè¿°
function description() {
    echo $outputPrefix"ç»„ä»¶åç§°ï¼š\"help\""
    echo $outputPrefix"åŠŸèƒ½ç®€ä»‹ï¼šè¿™ä¸ªæ˜¯ç”¨æ¥æŸ¥çœ‹LJBenchmarkçš„ç»„ä»¶åŠŸèƒ½å¸®åŠ©ä½¿ç”¨çš„"
    echo $outputPrefix"ç‰ˆæœ¬å·ï¼š0.0.1"
    echo $outputPrefix"ä½œè€…ï¼šé“¾å®¶"
    echo "\n"
}

# å¤„ç†é€»è¾‘
function dispose() {
    operation=$1
    if [[ $operation =~ ^--.* ]]
    then
        length=${#operation}
        cut_len=$(expr $length - 2)
        operation=${operation: 2 :$cut_len}
    else
        echo $outputPrefix"æ‚¨æ˜¯å¦è¦è¾“å…¥: sh benchmark help --$1 ?"
    fi

    if [ $operation ]
    then
        file_path=$benchmark_shell_path"/"$operation
        if [ -f $file_path ]
        then
            sh "$file_path" "--help"
        else
            echo $outputPrefix" $benchmark_shell_path è·¯å¾„ä¸‹æœªæœç´¢åˆ°è¯¥ç»„ä»¶"
        fi
    else
        echo $outputPrefix"æœªæœç´¢åˆ°è¯¥ç»„ä»¶"
    fi
}

# æ‰§è¡Œè„šæœ¬
main $@
